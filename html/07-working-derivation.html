<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Working Derivation - Nix Pills</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="custom.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="00-preface.html">Preface</a></li><li class="chapter-item expanded "><a href="01-why-you-should-give-it-try.html"><strong aria-hidden="true">1.</strong> Why You Should Give it a Try</a></li><li class="chapter-item expanded "><a href="02-install-on-your-running.html"><strong aria-hidden="true">2.</strong> Install on Your Running System</a></li><li class="chapter-item expanded "><a href="03-enter-environment.html"><strong aria-hidden="true">3.</strong> Enter the Environment</a></li><li class="chapter-item expanded "><a href="04-basics-of-language.html"><strong aria-hidden="true">4.</strong> The Basics of the Language</a></li><li class="chapter-item expanded "><a href="05-functions-and-imports.html"><strong aria-hidden="true">5.</strong> Functions and Imports</a></li><li class="chapter-item expanded "><a href="06-our-first-derivation.html"><strong aria-hidden="true">6.</strong> Our First Derivation</a></li><li class="chapter-item expanded "><a href="07-working-derivation.html" class="active"><strong aria-hidden="true">7.</strong> Working Derivation</a></li><li class="chapter-item expanded "><a href="08-generic-builders.html"><strong aria-hidden="true">8.</strong> Generic Builders</a></li><li class="chapter-item expanded "><a href="09-automatic-runtime.html"><strong aria-hidden="true">9.</strong> Automatic Runtime Dependencies</a></li><li class="chapter-item expanded "><a href="10-developing-with-nix-shell.html"><strong aria-hidden="true">10.</strong> Developing with nix-shell</a></li><li class="chapter-item expanded "><a href="11-garbage-collector.html"><strong aria-hidden="true">11.</strong> The Garbage Collector</a></li><li class="chapter-item expanded "><a href="12-inputs-design-pattern.html"><strong aria-hidden="true">12.</strong> Package Repositories and the Inputs Design Pattern</a></li><li class="chapter-item expanded "><a href="13-callpackage-design-pattern.html"><strong aria-hidden="true">13.</strong> Callpackage Design Pattern</a></li><li class="chapter-item expanded "><a href="14-override-design-pattern.html"><strong aria-hidden="true">14.</strong> Override Design Pattern</a></li><li class="chapter-item expanded "><a href="15-nix-search-paths.html"><strong aria-hidden="true">15.</strong> Nix Search Paths</a></li><li class="chapter-item expanded "><a href="16-nixpkgs-parameters.html"><strong aria-hidden="true">16.</strong> Nixpkgs Parameters</a></li><li class="chapter-item expanded "><a href="17-nixpkgs-overriding-packages.html"><strong aria-hidden="true">17.</strong> Nixpkgs Overriding Packages</a></li><li class="chapter-item expanded "><a href="18-nix-store-paths.html"><strong aria-hidden="true">18.</strong> Nix Store Paths</a></li><li class="chapter-item expanded "><a href="19-fundamentals-of-stdenv.html"><strong aria-hidden="true">19.</strong> Fundamentals of Stdenv</a></li><li class="chapter-item expanded "><a href="20-basic-dependencies-and-hooks.html"><strong aria-hidden="true">20.</strong> Basic Dependencies and Hooks</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Nix Pills</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="working-derivation"><a class="header" href="#working-derivation">Working Derivation</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Welcome to the seventh nix pill. In the previous <a href="06-our-first-derivation.html">sixth
pill</a> we introduced the notion of derivation in
the Nix language --- how to define a raw derivation and how to (try to)
build it.</p>
<p>In this post we continue along the path, by creating a derivation that
actually builds something. Then, we try to package a real program: we
compile a simple C file and create a derivation out of it, given a
blessed toolchain.</p>
<p>I remind you how to enter the Nix environment:
<code>source ~/.nix-profile/etc/profile.d/nix.sh</code></p>
<h2 id="using-a-script-as-a-builder"><a class="header" href="#using-a-script-as-a-builder">Using a script as a builder</a></h2>
<p>What's the easiest way to run a sequence of commands for building
something? A bash script. We write a custom bash script, and we want it
to be our builder. Given a <code>builder.sh</code>, we want the derivation to run
<code>bash builder.sh</code>.</p>
<p>We don't use hash bangs in <code>builder.sh</code>, because at the time we are
writing it we do not know the path to bash in the nix store. Yes, even
bash is in the nix store, everything is there.</p>
<p>We don't even use /usr/bin/env, because then we lose the cool stateless
property of Nix. Not to mention that <code>PATH</code> gets cleared when building,
so it wouldn't find bash anyway.</p>
<p>In summary, we want the builder to be bash, and pass it an argument,
<code>builder.sh</code>. Turns out the <code>derivation</code> function accepts an optional
<code>args</code> attribute which is used to pass arguments to the builder
executable.</p>
<p>First of all, let's write our <code>builder.sh</code> in the current directory:</p>
<pre><code>declare -xp
echo foo &gt; $out
</code></pre>
<p>The command <code>declare -xp</code> lists exported variables (<code>declare</code> is a
builtin bash function). As we covered in the previous pill, Nix computes
the output path of the derivation. The resulting <code>.drv</code> file contains a
list of environment variables passed to the builder. One of these is
<code>$out</code>.</p>
<p>What we have to do is create something in the path <code>$out</code>, be it a file
or a directory. In this case we are creating a file.</p>
<p>In addition, we print out the environment variables during the build
process. We cannot use env for this, because env is part of coreutils
and we don't have a dependency to it yet. We only have bash for now.</p>
<p>Like for coreutils in the previous pill, we get a blessed bash for free
from our magic nixpkgs stuff:</p>
<pre><code>nix-repl&gt; :l &lt;nixpkgs&gt;
Added 3950 variables.
nix-repl&gt; "${bash}"
"/nix/store/ihmkc7z2wqk3bbipfnlh0yjrlfkkgnv6-bash-4.2-p45"
</code></pre>
<p>So with the usual trick, we can refer to bin/bash and create
our derivation:</p>
<pre><code>nix-repl&gt; d = derivation { name = "foo"; builder = "${bash}/bin/bash"; args = [ ./builder.sh ]; system = builtins.currentSystem; }
nix-repl&gt; :b d
[1 built, 0.0 MiB DL]

this derivation produced the following outputs:
  out -&gt; /nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo
</code></pre>
<p>We did it! The contents of
<code>/nix/store/w024zci0x1hh1wj6gjq0jagkc1sgrf5r-foo</code> is really foo. We've
built our first derivation.</p>
<p>Note that we used <code>./builder.sh</code> and not <code>"./builder.sh"</code>. This way, it
is parsed as a path, and Nix performs some magic which we will cover
later. Try using the string version and you will find that it cannot
find <code>builder.sh</code>. This is because it tries to find it relative to the
temporary build directory.</p>
<h2 id="the-builder-environment"><a class="header" href="#the-builder-environment">The builder environment</a></h2>
<p>We can use <code>nix-store --read-log</code> to see the logs our builder produced:</p>
<pre><code>$ nix-store --read-log /nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo
declare -x HOME="/homeless-shelter"
declare -x NIX_BUILD_CORES="4"
declare -x NIX_BUILD_TOP="/tmp/nix-build-foo.drv-0"
declare -x NIX_LOG_FD="2"
declare -x NIX_STORE="/nix/store"
declare -x OLDPWD
declare -x PATH="/path-not-set"
declare -x PWD="/tmp/nix-build-foo.drv-0"
declare -x SHLVL="1"
declare -x TEMP="/tmp/nix-build-foo.drv-0"
declare -x TEMPDIR="/tmp/nix-build-foo.drv-0"
declare -x TMP="/tmp/nix-build-foo.drv-0"
declare -x TMPDIR="/tmp/nix-build-foo.drv-0"
declare -x builder="/nix/store/q1g0rl8zfmz7r371fp5p42p4acmv297d-bash-4.4-p19/bin/bash"
declare -x name="foo"
declare -x out="/nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo"
declare -x system="x86_64-linux"
</code></pre>
<p>Let's inspect those environment variables printed during the build
process.</p>
<ul>
<li>
<p><code>$HOME</code> is not your home directory, and <code>/homeless-shelter</code> doesn't
exist at all. We force packages not to depend on <code>$HOME</code> during the
build process.</p>
</li>
<li>
<p><code>$PATH</code> plays the same game as <code>$HOME</code></p>
</li>
<li>
<p><code>$NIX_BUILD_CORES</code> and <code>$NIX_STORE</code> are <a href="https://nixos.org/manual/nix/stable/command-ref/conf-file.html">nix configuration
options</a></p>
</li>
<li>
<p><code>$PWD</code> and <code>$TMP</code> clearly show that nix created a temporary build
directory</p>
</li>
<li>
<p>Then <code>$builder</code>, <code>$name</code>, <code>$out</code>, and <code>$system</code> are variables set
due to the .drv file's contents.</p>
</li>
</ul>
<p>And that's how we were able to use <code>$out</code> in our derivation and put
stuff in it. It's like Nix reserved a slot in the nix store for us, and
we must fill it.</p>
<p>In terms of autotools, <code>$out</code> will be the <code>--prefix</code> path. Yes, not the
make <code>DESTDIR</code>, but the <code>--prefix</code>. That's the essence of stateless
packaging. You don't install the package in a global common path under
<code>/</code>, you install it in a local isolated path under your nix store slot.</p>
<h2 id="the-drv-contents"><a class="header" href="#the-drv-contents">The .drv contents</a></h2>
<p>We added something else to the derivation this time: the args attribute.
Let's see how this changed the .drv compared to the previous pill:</p>
<pre><code>$ nix derivation show /nix/store/i76pr1cz0za3i9r6xq518bqqvd2raspw-foo.drv
{
  "/nix/store/i76pr1cz0za3i9r6xq518bqqvd2raspw-foo.drv": {
    "outputs": {
      "out": {
        "path": "/nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo"
      }
    },
    "inputSrcs": [
      "/nix/store/lb0n38r2b20r8rl1k45a7s4pj6ny22f7-builder.sh"
    ],
    "inputDrvs": {
      "/nix/store/hcgwbx42mcxr7ksnv0i1fg7kw6jvxshb-bash-4.4-p19.drv": [
        "out"
      ]
    },
    "platform": "x86_64-linux",
    "builder": "/nix/store/q1g0rl8zfmz7r371fp5p42p4acmv297d-bash-4.4-p19/bin/bash",
    "args": [
      "/nix/store/lb0n38r2b20r8rl1k45a7s4pj6ny22f7-builder.sh"
    ],
    "env": {
      "builder": "/nix/store/q1g0rl8zfmz7r371fp5p42p4acmv297d-bash-4.4-p19/bin/bash",
      "name": "foo",
      "out": "/nix/store/gczb4qrag22harvv693wwnflqy7lx5pb-foo",
      "system": "x86_64-linux"
    }
  }
}
</code></pre>
<p>Much like the usual
.drv, except that there's a list of arguments in there passed to the
builder (bash) with <code>builder.sh</code>... In the nix store..? Nix
automatically copies files or directories needed for the build into the
store to ensure that they are not changed during the build process and
that the deployment is stateless and independent of the building
machine. <code>builder.sh</code> is not only in the arguments passed to the
builder, it's also in the input derivations.</p>
<p>Given that <code>builder.sh</code> is a plain file, it has no .drv associated with
it. The store path is computed based on the filename and on the hash of
its contents. Store paths are covered in detail in <a href="18-nix-store-paths.html">a later
pill</a>.</p>
<h2 id="packaging-a-simple-c-program"><a class="header" href="#packaging-a-simple-c-program">Packaging a simple C program</a></h2>
<p>Start off by writing a simple C program called <code>simple.c</code>:</p>
<pre><code>void main() {
  puts("Simple!");
}
</code></pre>
<p>And its <code>simple_builder.sh</code>:</p>
<pre><code>export PATH="$coreutils/bin:$gcc/bin"
mkdir $out
gcc -o $out/simple $src
</code></pre>
<p>Don't worry too much about where those variables come from yet; let's
write the derivation and build it:</p>
<pre><code>nix-repl&gt; :l &lt;nixpkgs&gt;
nix-repl&gt; simple = derivation { name = "simple"; builder = "${bash}/bin/bash"; args = [ ./simple_builder.sh ]; gcc = gcc; coreutils = coreutils; src = ./simple.c; system = builtins.currentSystem; }
nix-repl&gt; :b simple
this derivation produced the following outputs:

  out -&gt; /nix/store/ni66p4jfqksbmsl616llx3fbs1d232d4-simple
</code></pre>
<p>Now you can run
<code>/nix/store/ni66p4jfqksbmsl616llx3fbs1d232d4-simple/simple</code> in your
shell.</p>
<h2 id="explanation"><a class="header" href="#explanation">Explanation</a></h2>
<p>We added two new attributes to the derivation call, <code>gcc</code> and
<code>coreutils</code>. In <code>gcc = gcc;</code>, the name on the left is the name in the
derivation set, and the name on the right refers to the gcc derivation
from nixpkgs. The same applies for coreutils.</p>
<p>We also added the <code>src</code> attribute, nothing magical --- it's just a
name, to which the path <code>./simple.c</code> is assigned. Like
<code>simple-builder.sh</code>, <code>simple.c</code> will be added to the store.</p>
<p>The trick: every attribute in the set passed to <code>derivation</code> will be
converted to a string and passed to the builder as an environment
variable. This is how the builder gains access to coreutils and gcc:
when converted to strings, the derivations evaluate to their output
paths, and appending <code>/bin</code> to these leads us to their binaries.</p>
<p>The same goes for the <code>src</code> variable. <code>$src</code> is the path to <code>simple.c</code>
in the nix store. As an exercise, pretty print the .drv file. You'll
see <code>simple_builder.sh</code> and <code>simple.c</code> listed in the input derivations,
along with bash, gcc and coreutils .drv files. The newly added
environment variables described above will also appear.</p>
<p>In <code>simple_builder.sh</code> we set the <code>PATH</code> for gcc and coreutils binaries,
so that our build script can find the necessary utilities like mkdir and
gcc.</p>
<p>We then create <code>$out</code> as a directory and place the binary inside it.
Note that gcc is found via the <code>PATH</code> environment variable, but it could
equivalently be referenced explicitly using <code>$gcc/bin/gcc</code>.</p>
<h2 id="enough-of-nix-repl"><a class="header" href="#enough-of-nix-repl">Enough of <code>nix repl</code></a></h2>
<p>Drop out of nix repl and write a file <code>simple.nix</code>:</p>
<pre><code>let
  pkgs = import &lt;nixpkgs&gt; { };
in
pkgs.stdenv.mkDerivation {
  name = "simple";
  builder = "${pkgs.bash}/bin/bash";
  args = [ ./simple_builder.sh ];
  gcc = pkgs.gcc;
  coreutils = pkgs.coreutils;
  src = ./simple.c;
  system = builtins.currentSystem;
}
</code></pre>
<p>Now you can build it with <code>nix-build simple.nix</code>. This will create a
symlink <code>result</code> in the current directory, pointing to the out path of
the derivation.</p>
<p>nix-build does two jobs:</p>
<ul>
<li>
<p><a href="https://nixos.org/manual/nix/stable/command-ref/nix-instantiate.html"> nix-instantiate
</a>:
parse and evaluate <code>simple.nix</code> and return the .drv file
corresponding to the parsed derivation set</p>
</li>
<li>
<p><a href="https://nixos.org/manual/nix/stable/command-ref/nix-store.html#operation---realise"> <code>nix-store -r</code>
</a>:
realise the .drv file, which actually builds it.</p>
</li>
</ul>
<p>Finally, it creates the symlink.</p>
<p>In the second line of <code>simple.nix</code>, we have an <code>import</code> function call.
Recall that <code>import</code> accepts one argument, a nix file to load. In this
case, the contents of the file evaluate to a function.</p>
<p>Afterwards, we call the function with the empty set. We saw this already
in <a href="05-functions-and-imports.html">the fifth pill</a>. To reiterate:
<code>import &lt;nixpkgs&gt; {}</code> is calling two functions, not one. Reading it as
<code>(import &lt;nixpkgs&gt;) {}</code> makes this clearer.</p>
<p>The value returned by the nixpkgs function is a set; more specifically,
it's a set of derivations. Calling <code>import &lt;nixpkgs&gt; {}</code> into a
<code>let</code>-expression creates the local variable <code>pkgs</code> and brings it into
scope. This has an effect similar to the <code>:l &lt;nixpkgs&gt;</code> we used in nix
repl, in that it allows us to easily access derivations such as <code>bash</code>,
<code>gcc</code>, and <code>coreutils</code>, but those derivations will have to be explicitly
referred to as members of the <code>pkgs</code> set (e.g., <code>pkgs.bash</code> instead of
just <code>bash</code>).</p>
<p>Below is a revised version of the <code>simple.nix</code> file, using the <code>inherit</code>
keyword:</p>
<pre><code>let
  pkgs = import &lt;nixpkgs&gt; { };
in
pkgs.stdenv.mkDerivation {
  name = "simple";
  builder = "${pkgs.bash}/bin/bash";
  args = [ ./simple_builder.sh ];
  inherit (pkgs) gcc coreutils;
  src = ./simple.c;
  system = builtins.currentSystem;
}
</code></pre>
<p>Here we also take the opportunity to introduce the <a href="https://nixos.org/manual/nix/stable/expressions/language-constructs.html#inheriting-attributes"><code>inherit</code>
keyword</a>.
<code>inherit foo;</code> is equivalent to <code>foo = foo;</code>. Similarly,
<code>inherit gcc coreutils;</code> is equivalent to
<code>gcc = gcc; coreutils = coreutils;</code>. Lastly,
<code>inherit (pkgs) gcc coreutils;</code> is equivalent to
<code>gcc = pkgs.gcc; coreutils = pkgs.coreutils;</code>.</p>
<p>This syntax only makes sense inside sets. There's no magic involved,
it's simply a convenience to avoid repeating the same name for both the
attribute name and the value in scope.</p>
<h2 id="next-pill"><a class="header" href="#next-pill">Next pill</a></h2>
<p>We will generalize the builder. You may have noticed that we wrote two
separate <code>builder.sh</code> scripts in this post. We would like to have a
generic builder script instead, especially since each build script goes
in the nix store: a bit of a waste.</p>
<p><em>Is it really that hard to package stuff in Nix? No</em>, here we're
studying the fundamentals of Nix.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="06-our-first-derivation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="08-generic-builders.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="06-our-first-derivation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="08-generic-builders.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
